<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/fyxq1.css" rel="stylesheet" />
		<script type="text/javascript" src="../js/lib/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="../js/lib/flexible.js"></script>
		<script type="text/javascript" src="../js/lib/flexible_css.js"></script>
		<link rel="stylesheet" type="text/css" href="../css/loupan_detail.css"/>
		<link rel="stylesheet" type="text/css" href="../css/jxfyList.css"/>
		<link rel="stylesheet" type="text/css" href="../css/sy.css"/>
	</head>
	<style>
		.ss_bt .zx:last-child{display: none;}
		.fy_xx .zdh,.fy_xx .md_price,.fy_xx .qt{font-size: 0.32rem!important;color: #333333!important;}
		.listtail li{height: 2.5rem!important;}
		.listtail .fy_pic{width: 2.8rem;height: 1.866666rem;}
		.listtail .fy_pic img{width: 100%;}
		.listtail .fy_xx{display: flex;flex-direction: column;justify-content: space-between;width: 5.8rem;height: 1.866666rem;margin-left: 0.266666rem;overflow: hidden;padding: 0.026666rem 0;}
		.listtail .fy_xx span{margin-right: 0.266666rem;}
		.fy_xx .zdh{font-weight: bold;}
		.m_price i,.d_price i{font-style: normal;color: #f45140;}
		.lp_nav i{font-size: 0.4rem;}
	</style>
		<header class="mui-bar mui-bar-nav fytail">
		    <div class="">
		    	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left fyxqfh"></a>
		    	<span class="titlezi building_name"></span>
		    </div>
		</header>
		<div class="mui-content fyzhuti">
		    <div class="fyxqyi">
		    	<!--轮播-->
				<div id="slider" class="mui-slider" >
				  <div class="mui-slider-group mui-slider-loop">
				    <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
				   
				  </div>
				  <div class="mui-slider-indicator imglunbo"></div>
				</div>
				<!--位置-->
				<div class="lp_xx">
					<p class="lp_wz">
						<span class="wz_ion"></span>
						<span class="wz_text address"></span>
					</p>
					<ul class="lp_nav">
						<li>市场均价<i class="price"></i>元/m²/天</li>
						<li><i class="kzfyS"></i>套房源可租</li>
					</ul>
				</div>
				<!--信息-->
				<div class="fuxqxx lp_bg">
					<div class="fyxqxxsan">
						<ul>
							<li>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">建成年代：</span>
									<span class="neirong m_m kprq"></span>
								</p>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">可否注册:</span>
									<span class="neirong m_m zc"></span>
								</p>
							</li>
							<li>
								<p class="">
									<span class="kognwrgwei n_n">产权性质：</span>
									<span class="neirong m_m chqxz" ></span>
								</p>
							</li>
							<li>
								<p class="">
									<span class="kognwrgwei n_n">物业公司：</span>
									<span class="neirong m_m wygs"></span>
								</p>
							</li>
							<li>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">物业费:</span>
									<span class="neirong m_m wyf"></span>
								</p>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">供暖费:</span>
									<span class="neirong m_m gnf"></span>
								</p>
							</li>
							<li>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">车位数量：</span>
									<span class="neirong m_m tcwsl"></span>
								</p>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">停车费:</span>
									<span class="neirong m_m tcf"></span>
								</p>
							</li>
							<li>
								<p class="stkrgw">
									<span class="kognwrgwei n_n">网络公司：</span>
									<span class="neirong m_m wlgs"></span>
								</p>
							</li>
						</ul>
					</div>
				</div>
		    </div>
		    <!--先租房、与租房、写字楼-->
		    <div style="display: flex;">
			    <ul class="scmenu">
			    	<li><span class="present_renting active">现租房</span></li>
			    	<li><span class="prerental_house">预租房</span></li>
			    </ul>
		    	<ul class="scmenu1">

			    	<li><span class="office_building">写字楼</span></li>

			    	<li><span class="apartment">公寓</span></li>
			    	<li><span class="business_building">商务楼</span></li>
			    	<li><span class="business">商业</span></li>
			    </ul>
		    </div>

		    <div class="qh_q" style="display: block;">
		    <!--先租房-->
		    	<ul class="fy_list listUl ss_bt">
				 	
				</ul>
		    </div>
		    <h1 class="ck_more" style="height: 1rem;line-height: 1rem;text-align: center;font-size: 0.373333rem;color: #2B70D8;background: #fff;">查看更多</h1>
		    
		    <!--楼盘介绍-->
		    <div class="jieshao">
		    	<p class="lp_nm " style="font-size: 0.373333rem;font-weight: bold;">楼盘介绍</p>
		    	<p class="lp_nm desp" style="text-align: left;padding: 0 0.4rem;height: auto;"></p>
		    </div>
		     <div class="pt20 mb08 border-tb bg-white" id="kuan">
        <h2 class="sort-title tc fb mb20" style="text-align: center;font-size: 0.373333rem;font-weight: bold;">周边配套</h2>
        <div  id="allmap" style="width:100%;height:100%;"></div>
        <ul class="text-gray6 clearfix ph15" id="map_item_ul">
          <li class="supporting-item">
            <i class="supporting-icon sup-ct img12" style="position: relative;left: -0.0em;"></i>
            <span class="db">餐厅</span>
          </li>
          <li class="supporting-item">
            <i class="supporting-icon sup-jd img13" style="position: relative;left: -0.0em;"></i>
            <span class="db">酒店</span>
          </li>
          <li class="supporting-item">
            <i class="supporting-icon sup-js img14" style="position: relative;left: -0.0em;"></i>
            <span class="db">健身</span>
          </li>
          <li class="supporting-item">
            <i class="supporting-icon sup-yh img15" style="position: relative;left: -0.0em;"></i>
            <span class="db">银行</span>
          </li>
        </ul>
      </div>
		</div>
	<body>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/lib/castapp.js" ></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?ak=pTHixzeMKbBbtNwycGsv47DuGjqEOgQw&v=2.0"></script>
		<script src="../js/lib/app_config.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		(function(){
			var le=0;
			var   positionData="";
//			detailData();
			var allmap="";
		})();
			/*图片自动轮播*/
			
			//获得slider插件对象
			var gallery = mui('.mui-slider');
			gallery.slider({
			  interval:3000//自动轮播周期，若为0则不自动播放，默认为0；
			});
			
			document.querySelector('.mui-slider').addEventListener('slide', function(event) {
			  //注意slideNumber是从0开始的；
			  $('.imglunbo').html(event.detail.slideNumber+1+'/'+le);
			  /*alert("你正在看第"+(event.detail.slideNumber+1)+"张图片");*/
			});
			/*注意:如果ajax获得图片后，需要在写入图片以后，需要从新调用一下*/
			gallery.slider();
			
			
			var lp_id = '';
			var page = 1;
			var lp_leibie = 1;//现租房1；预租房0；

			var lp_leib = '';
//			window.addEventListener("loppan_id", function (e) {
//			    //获得事件参数
//				localStorage.setItem('lp_id',e.detail.lp_id);
//				lp_id = e.detail.lp_id;
//				alert(lp_id);
//				detailDataHouses(lp_id,page,lp_leibie,lp_leib);
//			});
			mui.plusReady(function(){
                var self = plus.webview.currentWebview();
                lp_id = self.lpid;
                localStorage.setItem('lp_id',self.lpid);
                detailData(lp_id);
                detailDataHouses(lp_id,page,lp_leibie,lp_leib);
            });
			
			//tab切换
			var tabNav = $('.scmenu');
			var tabSp = $('.scmenu li');
			var tabSps = $('.scmenu li span');
			for (var i=0; i<tabSp.length; i++) {
				(function(index){
					tabSp[i].onclick = function(){
						for(var j=0; j<tabSp.length; j++){
							tabSps[j].className = '';
						}
						tabSps[index].className = 'active';	
						if($('.scmenu li').eq(index).text() == '现租房'){
							$('.ss_bt').html('');
							lp_leibie = 1;
							page = 1;
							detailDataHouses(lp_id,page,lp_leibie,lp_leib);
						}
						if($('.scmenu li').eq(index).text() == '预租房'){
							$('.ss_bt').html('');
							lp_leibie = 0;
							page = 1;
							detailDataHouses(lp_id,page,lp_leibie,lp_leib);
						}
					}
				})(i)
			}
			//tab切换
			var tabNav1 = $('.scmenu1');
			var tabSp1 = $('.scmenu1 li');
			var tabSps1 = $('.scmenu1 li span');
			for (var i=0; i<tabSp1.length; i++) {
				(function(index){
					tabSp1[i].onclick = function(){
						$('.ss_bt').html('');
						for(var j=0; j<tabSp1.length; j++){
							tabSps1[j].className = '';
						}
						tabSps1[index].className = 'active';	
						lp_leib = tabSps1[index].innerHTML;
						page = 1;
						detailDataHouses(lp_id,page,lp_leibie,lp_leib);
					}
				})(i)
			}
			//楼盘详情切换菜单
			function lxqh(){//类型切换
				
			}
			
			
			$('.ck_more').click(function(){
				page++;
				detailDataHouses(lp_id,page,lp_leibie,lp_leib);
			});
			
			
			mui.init();
			var data=[];
			var lp_str = '';//模板字符//
			/*楼盘数据*/
			function  detailDataHouses(id,page,lp_leibie,lp_leib){
//				console.log('-------------------------楼盘详情----------------------------------')
//				console.log(id);
//				console.log(page);
//				console.log(lp_leibie+'前两个菜单');
//				console.log(lp_leib+'后四个菜单');

				if(id == '' || id == undefined){
					id = localStorage.getItem('lp_id');
				}
				mui.ajax(url+'/yhcms/web/lpjbxx/getZdLpxq.do',{
					data:{
						"parameters":{
							"building_id":id,
							"curr_page":page,
							"items_perpage":"5",
							"area":lp_leib,
							"real":lp_leibie
						},
						"foreEndType":2,
						"code":"30000002"
						},
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						if(data.success){
							var lp_data = data.data.houses;
							console.log(lp_data);
							if(lp_data == [] || lp_data == ''){
								mui.toast("没有更多数据了",{ duration:'2000', type:'div' });
							}
							for (var i=0; i<lp_data.length; i++) {
								if(lp_data[i].fjzt == ''){
									lp_str = '<li class="listtail" onclick="linktodetail('+lp_data[i].id+')"><div class="fy_pic"><img src="'+img_url+lp_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="zdh">'+lp_data[i].zdh+"-"+lp_data[i].fybh+'</p><p class="md_price"><span class="d_price"><i>'+lp_data[i].daily_price+'</i>元/m²/天</span><span class="m_price"><i>'+lp_data[i].monthly_price+'</i>元/月</span></p><p class="qt"><span>'+lp_data[i].housing_area+'m²</span><span>'+lp_data[i].workstation+'个工位</span><span style="color:#2b70d8;">'+lp_data[i].fjzt+'</span></p></div></li><li class="zx"></li>';
								}else{
									lp_str = '<li class="listtail" onclick="linktodetail('+lp_data[i].id+')"><div class="fy_pic"><img src="'+img_url+lp_data[i].housing_icon+'" alt="" /></div><div class="fy_xx"><p class="zdh">'+lp_data[i].zdh+"-"+lp_data[i].fybh+'</p><p class="md_price"><span class="d_price"><i>'+lp_data[i].daily_price+'</i>元/m²/天</span><span class="m_price"><i>'+lp_data[i].monthly_price+'</i>元/月</span></p><p class="qt"><span>'+lp_data[i].housing_area+'m²</span><span>'+lp_data[i].workstation+'个工位</span><span style="color:#2b70d8;">'+lp_data[i].fjzt+'</span></p></div></li><li class="zx"></li>';
								}
								$('.ss_bt').append(lp_str);
							}
						}else{
							mui.alert(data.message);
						}
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log(type);
					}
				});
			}
			
			function linktodetail(id){
				mui.openWindow({ 
					url:'./fyTail.html', //需要打开页面的url地址 
					id:'fyTail',
					extras:{
				      fyid:id
				    },
				});				
			}
			
			function  detailData(id){
				if(id == '' || id == undefined){
					id = localStorage.getItem('lp_id');
				}
				mui.ajax(url+'/yhcms/web/lpjbxx/getZdLpxq.do',{
					data:{
						"parameters":{"building_id":lp_id,"curr_page":1,"items_perpage":"5","area":"写字楼","real":1},
						"foreEndType":2,
						"code":"30000002"
						},
					dataType:'json',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					headers:{'Content-Type':'application/json'},	              
					success:function(data){
						if(data.success){
							//如果页数 是 1获取楼盘信息     如果页数不是1  则无需赋值
							var lpdata=data.data1;
							$(".building_name").html(lpdata.building_name);
							$(".desp").html(lpdata.desp);
							$(".gnf").html(lpdata.gnf+"元/㎡/季");
							$(".kprq").html(lpdata.kprq);
							$(".kzfyS").html(lpdata.kzfyS);
							$(".price").html(lpdata.price);
							$(".tcf").html(lpdata.tcf+"元/月");
							$(".tcwsl").html(lpdata.tcwsl);
							$(".wlgs").html(lpdata.wlgs);
							$(".wyf").html(lpdata.wyf+"元/㎡/月");
							$(".wygs").html(lpdata.wygs);
							$(".zc").html(lpdata.zc);
							var ch1=lpdata.chqxz;
							if(ch1!=""){
							var ch2=ch1.split("、");
							var chs="";
							for(var i=0;i<ch2.length;i++){
								var t=ch2[i];
								if(t==1){
									chs+="写字楼 ";
								}else if(t==2){
									chs+="公寓 ";
								}else if(t==3){
									chs+="商务楼 ";
								}else if(t==5){
									chs+="商业 ";
								}
							}
							$(".chqxz").html(chs);
							}
							$(".address").html(lpdata.district+" "+lpdata.address);
							//图片轮播信息
							var housing_icon=lpdata.building_images;
									if(housing_icon!=""){
										le=housing_icon.split(";").length;
										$(".imglunbo").html("1/"+le);
									}
							var h_img="";
									$(".mui-slider-loop").html(h_img);
									if(housing_icon!=""){
										var hous_img=housing_icon.split(";");
										var v1="";
										var v2="";
										for(var i=0;i<hous_img.length;i++){
											var ims=hous_img[i];
											if(i==0){
												v1+=' <div class="mui-slider-item mui-slider-item-duplicate">';
												v1+='<a href="#">';
												v1+='<img src="http://47.92.145.21:81/'+ims+'" alt="" />';
												v1+=' </a> </div>';
											}else if(i==hous_img.length-1){
												v2+=' <div class="mui-slider-item mui-slider-item-duplicate">';
												v2+='<a href="#">';
												v2+='<img src="http://47.92.145.21:81/'+ims+'" alt="" />';
												v2+=' </a> </div>';
											}
										}
										for(var i=0;i<hous_img.length;i++){
												var ims=hous_img[i];
												if(i==0){
													h_img+=v2;
												} 
												h_img+=' <div class="mui-slider-item">';
												h_img+='<a href="#">';
												h_img+='<img src="http://47.92.145.21:81/'+ims+'" alt="" />';
												h_img+=' </a> </div>';
												
												if(i==hous_img.length-1){
												h_img+=v1;
											}
											
										}
										$(".mui-slider-loop").html(h_img);
										/*图片自动轮播*/
									ca.init();
									castapp.pictureScroll({
									    callback:function(pictureNumber){
						//				    console.log(pictureNumber);
									    },
									    isAutoScroll:true,
									    scrollTime:3
									});
									}
							//地图   根据经度 纬度
							positionData =lpdata.longitude;
							      positionData+= ',';
							      positionData+=lpdata.latitude;
	                        bMap(positionData);
						}else{
							mui.alert(data.message);
						}
						
					},
					error:function(xhr,type,errorThrown){
						//异常处理；
						console.log(type);
					}
				});
			}
			//搜索查询房源数据
			
			
			  //百度地图
     function  bMap(pos_data){
        var posArr = pos_data.split(',');
        var map = new BMap.Map("allmap");    // 创建Map实例
         allmap = map;
        var point = new BMap.Point(posArr[0], posArr[1]);
        map.centerAndZoom(new BMap.Point(posArr[0], posArr[1]), 15);  // 初始化地图,设置中心点坐标和地图级别
        map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
        map.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
        var marker = new BMap.Marker(point);  // 创建标注
        map.addOverlay(marker);
        //标签点击
        $('#map_item_ul li').click(function () {
          var index = $(this).index() + 1;
          /*var main = plus.webview.getWebviewById('map');
				mui.fire(main, "map",{
				    pos_data:pos_data,
				    index:index
				})
				*/
				mui.openWindow({ 
					url:'map.html', //需要打开页面的url地址 
					id:'map',  //需要打开页面的url页面id
					extras:{ 
						pos_data:pos_data,
				        index:index
	//					.....//自定义扩展参数，可以用来处理页面间传值 
					},show:{ //控制打开页面的类型
						autoShow:true,
	//					//页面loaded事件发生后自动显示，默认为true 
						aniShow:'slide-in-right',//页面显示动画，默认为”slide-in-right“；  页面出现的方式 左右上下
						duration:''//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒； 
					}
				});
          
         // location.href = "http://m.amap.com/around/?locations=" + pos_data + "&keywords=餐厅,酒店,健身,银行&defaultIndex=" + index + "&defaultView=&searchRadius=1000&key=cc238157d6183b1d54404a704bb86171&defaultView=map";

        });
          }
      
//   function   getPoi(keyword, bind){
//        const that = this;
//        var options = {
//            pageCapacity: 100,
//            onSearchComplete: (results)=>{
//                that[bind] = results.getNumPois();
//            }
//        };
//        var local = new BMap.LocalSearch(this.allmap, options);
//        local.search(keyword);
//    }
		</script>
	</body>

</html>